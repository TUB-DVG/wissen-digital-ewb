<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Running the app in production &#8212; webcentral 0.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=27fed22d" />
    <script src="../_static/documentation_options.js?v=d45e8c67"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Style Guide" href="../dev/style_guide.html" />
    <link rel="prev" title="Django - Migrations" href="migrations.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="running-the-app-in-production">
<h1>Running the app in production<a class="headerlink" href="#running-the-app-in-production" title="Link to this heading">¶</a></h1>
<p>The following sections address topics, which come up when running the Application in production.
Since the <code class="docutils literal notranslate"><span class="pre">Wissensplattform</span></code> and the <code class="docutils literal notranslate"><span class="pre">CityGML</span> <span class="pre">Visulizations</span></code> app were developed independently, there are different deployment possiblities. Both apps can be indipendently or together. In the following sections the different deployment strategies are described.</p>
<section id="running-wissensplattform-without-citygml-visulizations">
<h2>Running Wissensplattform without CityGML visulizations<a class="headerlink" href="#running-wissensplattform-without-citygml-visulizations" title="Link to this heading">¶</a></h2>
<p>At first, the deployment of the <code class="docutils literal notranslate"><span class="pre">Wissensplattform</span></code> without the <code class="docutils literal notranslate"><span class="pre">CityGML</span> <span class="pre">visulizations</span></code> app is discussed.
In general, the production mode of the application can be seen as a security hardend version of the development mode. This includes the security on the container level or web security features like HTTPS and CSP.</p>
<section id="https">
<h3>HTTPS<a class="headerlink" href="#https" title="Link to this heading">¶</a></h3>
<p>Using the HTTPS protocol allows to encrypt the HTTP pakets going through the unsecure internet. Since many browsers today have implemented a HTTPS-only mode and using HTTP is generally flagged unsecure, the production mode of the <code class="docutils literal notranslate"><span class="pre">Wissensplattform</span></code> implements a HTTPS only mode. That means that only connections using HTTPS can be established. To enable the <code class="docutils literal notranslate"><span class="pre">nginx</span></code>-webserver to encrypt and decrypt traffic a SSL-certificate and a private key needs to be given. These 2 files need to be stored in <code class="docutils literal notranslate"><span class="pre">nginx/conf/</span></code>-folder. Furthermore the filenames have to be provided inside the <code class="docutils literal notranslate"><span class="pre">.env</span></code>-file. The following code listing shows an example on how to add the filenames of the certificate and key file to the <code class="docutils literal notranslate"><span class="pre">.env</span></code>-file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NGINX_SSL_CERTIFICATE_FILENAME</span><span class="o">=</span><span class="n">ssl_certificate</span><span class="o">.</span><span class="n">crt</span>
<span class="n">NGINX_SSL_CERTIFICATE_KEY_FILENAME</span><span class="o">=</span><span class="n">private_key</span><span class="o">.</span><span class="n">key</span>
</pre></div>
</div>
</section>
<section id="general-procedure">
<h3>General procedure<a class="headerlink" href="#general-procedure" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>Copy the certificate and private key file, like shown in the previous section.</p></li>
<li><p>Build the app: This needs to be done, since the certificate- and private key file needs to be copied into the <code class="docutils literal notranslate"><span class="pre">nginx</span></code> docker image:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">run</span> <span class="n">build_initial</span> <span class="n">prod</span>
</pre></div>
</div>
<p>If on the computer you are deploying the <code class="docutils literal notranslate"><span class="pre">EWB</span> <span class="pre">Wissensplattform</span></code> a deployment has already be made, there should be a database already present inside a docker volume.</p>
<section id="already-present-database">
<h4>Already present database<a class="headerlink" href="#already-present-database" title="Link to this heading">¶</a></h4>
<p>If this is the case you can just start the <code class="docutils literal notranslate"><span class="pre">EWB</span> <span class="pre">Wissensplattform</span></code> in the forground of the terminal you are using or in the background using <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">compose</span></code> together with the <code class="docutils literal notranslate"><span class="pre">-d</span></code> flag:
3. You can use the <code class="docutils literal notranslate"><span class="pre">run</span></code>-script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">run</span> <span class="n">up</span> <span class="n">prod</span>
</pre></div>
</div>
<p>This starts the application in production mode in the foreground of the terminal.
Or you can use the <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">compose</span></code> syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">compose</span> <span class="o">-</span><span class="n">f</span> <span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="o">.</span><span class="n">yml</span> <span class="o">-</span><span class="n">f</span> <span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="o">.</span><span class="n">prod</span><span class="o">.</span><span class="n">yml</span> <span class="n">up</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The docker compose command is not fully equivalent to the run-script command since the -d flag is added, which detaches the compose command from the current terminal. If you like to keep the execution in the foreground of the current terminal you can skip the -d flag.</p>
</div>
</section>
<section id="newly-created-database">
<h4>Newly created database<a class="headerlink" href="#newly-created-database" title="Link to this heading">¶</a></h4>
<p>If there was is no database present the following steps need to be taken:
3. Use the present dump in the <code class="docutils literal notranslate"><span class="pre">postgres/</span></code>-folder or a dump which was created in the past. You can either use the <code class="docutils literal notranslate"><span class="pre">run</span></code>-script with the <code class="docutils literal notranslate"><span class="pre">up_initial</span></code> command or a series of run-script commands, which will be described in tthe following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">run</span> <span class="n">up_initial</span> <span class="n">prod</span> <span class="n">postgres</span><span class="o">/</span><span class="n">dump_filename</span><span class="o">.</span><span class="n">sql</span> 
</pre></div>
</div>
<p>The above command is one convience command, starting the application, importing the dump with the name <code class="docutils literal notranslate"><span class="pre">dump_filename.sql</span></code> from the <code class="docutils literal notranslate"><span class="pre">postgres/</span></code> folder and restarting it bring the <code class="docutils literal notranslate"><span class="pre">EWB</span> <span class="pre">Wissensplattform</span></code> into a healthy state.
Alternativly all the steps to import the dump can be done manually:
3. Start the application:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">run</span> <span class="n">up</span> <span class="n">prod</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Open a second terminal and navigate to the root-folder of the project.
Executing the following command will load the dump with the filename <code class="docutils literal notranslate"><span class="pre">dump_filename.sql</span></code> from the <code class="docutils literal notranslate"><span class="pre">postgres/</span></code>-folder:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">run</span> <span class="n">restore_db</span> <span class="n">postgres</span><span class="o">/</span><span class="n">dump_filename</span><span class="o">.</span><span class="n">sql</span>
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>After the import process has been completed, the web application needs to be restarted. To do that please switch back to the terminal where the <code class="docutils literal notranslate"><span class="pre">EWB</span> <span class="pre">Wissensplattform</span></code> is running and stop it using <code class="docutils literal notranslate"><span class="pre">CTRL+C</span></code>. After that restart it using:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">run</span> <span class="n">up</span> <span class="n">prod</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">compose</span> <span class="o">-</span><span class="n">f</span> <span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="o">.</span><span class="n">yml</span> <span class="o">-</span><span class="n">f</span> <span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="o">.</span><span class="n">prod</span><span class="o">.</span><span class="n">yml</span> <span class="n">up</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
<p>to start it in detached mode in the background.</p>
</section>
</section>
</section>
<section id="cache-busting-techniques">
<h2>Cache busting techniques<a class="headerlink" href="#cache-busting-techniques" title="Link to this heading">¶</a></h2>
<p>When developing the application in an agile manner lots of changes will be introduced to the web application when its already running publicly. Because of that problems can arise. One problem has to do with the client browser caches static files (javascript/stylesheet-files) to reduce loading time. This can lead to websites look broken for clients re-visiting the website since the still use the old cached versions.
To address that problem a static files bundler <code class="docutils literal notranslate"><span class="pre">webpack</span></code> is used. It transpiles the <code class="docutils literal notranslate"><span class="pre">scss</span></code>-files into one <code class="docutils literal notranslate"><span class="pre">css</span></code>-file. A hash-value is also put into the filename. The also installed package <code class="docutils literal notranslate"><span class="pre">wepback-bundler-tracker</span></code> creates a file <code class="docutils literal notranslate"><span class="pre">weback-stats.json</span></code> where the location of the created css-files is stored. The stats file is then used by the package <code class="docutils literal notranslate"><span class="pre">django-weback-loader</span></code> to insert the most up-to-date file in stylesheet link tag in the django templates.</p>
<p>The configuration of <code class="docutils literal notranslate"><span class="pre">django-weback-loader</span></code> is done in the <code class="docutils literal notranslate"><span class="pre">settings.py</span></code>-file. There, the following lines were added:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">WEBPACK_LOADER</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;DEFAULT&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;BUNDLE_DIR_NAME&#39;</span><span class="p">:</span> <span class="s1">&#39;/webpack_bundles/&#39;</span><span class="p">,</span>
        <span class="s1">&#39;CACHE&#39;</span><span class="p">:</span> <span class="ow">not</span> <span class="n">DEBUG</span><span class="p">,</span>
        <span class="s1">&#39;STATS_FILE&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">&#39;webpack-stats.json&#39;</span><span class="p">),</span>
        <span class="s1">&#39;POLL_INTERVAL&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="s1">&#39;IGNORE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;.+\.hot-update.js&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;.+\.map&#39;</span><span class="p">],</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The location of the transpiled bundles are specified in the <code class="docutils literal notranslate"><span class="pre">BUNDLE_DIR_NAME</span></code> constant. The location specified must be reachable from within the location specified in the <code class="docutils literal notranslate"><span class="pre">STATICFILES_DIR</span></code> constant.
The location of the <code class="docutils literal notranslate"><span class="pre">webpack-bundler-loader</span></code> stats-file is specfied in <code class="docutils literal notranslate"><span class="pre">STATS_FILE</span></code>. A absolute path is taken as input. Furthermore the intervall in which changes in the stats file are checked can be set via <code class="docutils literal notranslate"><span class="pre">POLL_INTERVAL</span></code> in seconds. Polling is only activated if the django <code class="docutils literal notranslate"><span class="pre">DEBUG</span></code>-flag is set to true. <code class="docutils literal notranslate"><span class="pre">DEBUG</span></code> beeing <code class="docutils literal notranslate"><span class="pre">True</span></code> typically means that django is executed in a development environment, and <code class="docutils literal notranslate"><span class="pre">DEBUG</span></code> equals <code class="docutils literal notranslate"><span class="pre">False</span></code> is set on a production instance.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">webcentral</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic_structure.html">Structure of the EWB Wissensplattform</a></li>
<li class="toctree-l1"><a class="reference internal" href="interacting_with_the_app.html">Interacting with the EWB Wissensplattform</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration_env_file.html">Configuration using .env file</a></li>
<li class="toctree-l1"><a class="reference internal" href="structure_project_repo.html">Project repository structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_import.html">Data-Import</a></li>
<li class="toctree-l1"><a class="reference internal" href="migrations.html">Django - Migrations</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Running the app in production</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#running-wissensplattform-without-citygml-visulizations">Running Wissensplattform without CityGML visulizations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cache-busting-techniques">Cache busting techniques</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev/style_guide.html">Style Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/static_code_analysis.html">Static code analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/pyproject_toml.html">pyproject.toml</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/testing.html">Testing the Wissensplattform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/load_profiles.html">Load Profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/plotly_apps.html">Plotly Apps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/plotly_apps.html#framework">Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/csp.html">Content security policy (CSP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/use_cases.html">Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/use_cases.html#usecase-model-documentation"><code class="docutils literal notranslate"><span class="pre">UseCase</span></code> Model Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/use_cases.html#use-cases-plotly-documentation">Use Cases plotly documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/use_cases.html#further-information">Further Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/save_page_views.html">Page views</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">HowTo:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../HowTo/create_dump_for_repo.html">Create a dump for for the repository</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../templateStructure.html">Template structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../translation.html">Translation of Content</a></li>
<li class="toctree-l1"><a class="reference internal" href="../listing_pages.html">Listing pages</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="migrations.html" title="previous chapter">Django - Migrations</a></li>
      <li>Next: <a href="../dev/style_guide.html" title="next chapter">Style Guide</a></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2023, DVG.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../_sources/general/production.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>